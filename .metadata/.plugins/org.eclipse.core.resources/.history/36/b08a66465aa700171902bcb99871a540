package controller;

import java.util.Scanner;
import java.util.LinkedList;
import java.util.List;

import model.Grain;
import model.Nozzle;
import model.Result;
import model.RocketMotor;

/**
 * CMDLineInterface.java
 * 
 * This class runs the command-line interface for iteration 1 of OpenBurn.
 * The goal is to be able to run and produce accurate results before the
 * GUI is in place.
**/

public class CMDLineInterface
{
	// Private string constants
	private static final String START_MSG = "OpenBurn: Iteration #1\n";
	
	private static final String GRAIN_NUM = "Grain number: ";
	
	private static final String GRAIN_PROMPT   = "Enter number of grains (Must enter at least 1): ";
	private static final String DENSITY_PROMPT = "Enter propellant density (Must be positive): ";
	
	private static final String OUTER_DIAMETER_PROMPT = "Enter outer diameter (Must be non-negative): ";
	private static final String INNER_DIAMETER_PROMPT = "Enter inner diameter (Must be non-negative): ";
	
	private static final String LENGTH_PROMPT = "Enter length (Must be non-negative): ";
	
	private static final String BURNING_ENDS_PROMPT = "Enter number of burning ends (Must be 0, 1, or 2): ";
	
	// Error Messages
	private static final String NULL_SCANNER_MSG  = "\nERROR: Null scanner for input!\n";
	private static final String INPUT_ERROR_MSG   = "\nERROR: Invalid input!\n";
	
	
	// Error status
	private static final int ERROR_OCCURRED = 1;
	
	
	
	/**
	 * main()
	 * 
	 * Purpose:
	 * 
	 * Parameters:
	 * 		String[] args -- Command-line arguments. Not needed here.
	 * 
	 * Returns: void.
	**/
	
	public static void main (String[] args)
	{
		System.out.println(START_MSG);
		
		// Scanner for keyboard input
		Scanner input = new Scanner(System.in);
		
		// Prompt user for number of grains
		// Prompt user for propellant density
		int numberOfGrains = promptNumGrains(input);
		promptPropellantDensity(input);
		
		// Continuously prompt the user for input and create a list of Grains
		// Current implementation of the list is: LinkedList
		List<Grain> listOfGrains = new LinkedList<Grain>();
		for (int grainNum = 0; grainNum < numberOfGrains; grainNum++)
		{
			System.out.println(GRAIN_NUM + grainNum);
			listOfGrains.add(createGrain(input));
		}
		
		/*
		Nozzle noz = getCMDnizzel(input, numberOfGrains);
		
		double deltaTime = -1;
		while(deltaTime <= 0)
		{
			System.out.print("What time step do you want to use? must be positive.  ");
			if(input.hasNextInt() == false)
			{
				System.err.println("\nERROR: Something went wrong with scanner.");
			}
			else
			{
				deltaTime = input.nextInt();
			}
		}
		
		LinkedList<Result> theResults = RocketMotor.simulate(listOfGrains, deltaTime, noz);
		
		
		// more stuff here eventually
		*/
		
		input.close();   // Close keyboard input
	} // main()
	
	
	
	/**
	 * promptNumGrains()
	 * 
	 * Purpose: Prompts the user for a number of motor grains, then
	 * 		returns the answer.
	 * 
	 * Parameters:
	 * 		Scanner input -- User input, preferably keyboard input.
	 * 
	 * Returns: int. The number of grains given by the user.
	**/
	
	private static int promptNumGrains (Scanner input)
	{
		// Check for null scanner
		if (input == null)
			throw new IllegalArgumentException(NULL_SCANNER_MSG);
		
		// Prompt the user for input until a positive number or error
		int numberOfGrains = -1;
		while (numberOfGrains < 1)
		{
			System.out.print(GRAIN_PROMPT);   // Prompt message
			
			// Response was not an integer, error
			if (input.hasNextInt() == false)
			{
				System.err.println(INPUT_ERROR_MSG);
				System.exit(ERROR_OCCURRED);
			}
			
			// Valid input
			else
				numberOfGrains = input.nextInt();
		}
		
		return numberOfGrains;
	} // promptNumGrains()
	
	
	
	/**
	 * promptPropellantDensity()
	 * 
	 * Purpose: Prompts the user for the propellant density, then
	 * 		sets the density to the user response for all Grains.
	 * 
	 * Parameters:
	 * 		Scanner input -- User input, preferably keyboard input.
	 * 
	 * Returns: void.
	**/
	
	private static void promptPropellantDensity (Scanner input)
	{
		// Check for null scanner
		if (input == null)
			throw new IllegalArgumentException(NULL_SCANNER_MSG);
		
		// Prompt the user for input until a positive number or error
		double density = -1.0;
		while (density <= 0.0)
		{
			System.out.print(DENSITY_PROMPT);   // Prompt message
			
			// Response was not a double, error
			if (input.hasNextDouble() == false)
			{
				System.err.println(INPUT_ERROR_MSG);
				System.exit(ERROR_OCCURRED);
			}
			
			// Valid input
			else
				density = input.nextDouble();
		}
		
		// Set the propellant density for Grains
		Grain.setPropellantDensity(density);
	} // promptPropellantDensity()
	
	
	
	/**
	 * createGrain()
	 * 
	 * Purpose: Creates and returns a Grain object by prompting the
	 * 		user for input. It is recommended that the input is
	 * 		given by keyboard.
	 * 
	 * Parameters:
	 * 		Scanner input -- User input, preferably keyboard input.
	 * 
	 * Returns: Grain. A new Grain object with data from user input.
	**/
	
	private static Grain createGrain (Scanner input)
	{
		// Initialize all dimensions for loops
		double outerDiameter = -1.0;
		double innerDiameter = -1.0;
		
		// Prompt the user for inner and outer diameters until the outer
		// diameter is greater than the inner diameter.
		while (innerDiameter >= outerDiameter)
		{
			outerDiameter = promptOuterDiameter(input);
			innerDiameter = promptInnerDiameter(input);
		}
		
		// Prompt user for a length
		double length = promptLength(input);
		
		// Prompt user for the number of burning ends
		int numBurningEnds = promptNumBurningEnds(input);
		
		// Use new data to create and return a Grain
		return (new Grain(length, outerDiameter, innerDiameter, numBurningEnds));
	} // createGrain()
	
	
	
	/**
	 * promptOuterDiameter()
	 * 
	 * Purpose: Prompts the user for the outer diameter of a grain,
	 * 		then returns the answer.
	 * 
	 * Parameters:
	 * 		Scanner input -- User input, preferably keyboard input.
	 * 
	 * Returns: double. The outer diameter of a grain.
	**/
	
	private static double promptOuterDiameter (Scanner input)
	{
		// Check for null scanner
		if (input == null)
			throw new IllegalArgumentException(NULL_SCANNER_MSG);
		
		// Prompt the user for input until a non-negative number or error
		double outerDiameter = -1.0;
		while (outerDiameter <= 0.0)
		{
			System.out.print(OUTER_DIAMETER_PROMPT);   // Prompt message
			
			// Response was not a double, error
			if (input.hasNextDouble() == false)
			{
				System.err.println(INPUT_ERROR_MSG);
				System.exit(ERROR_OCCURRED);
			}
			
			// Valid input
			else
				outerDiameter = input.nextDouble();
		}
		
		return outerDiameter;
	} // promptOuterDiameter()
	
	
	
	/**
	 * promptInnerDiameter()
	 * 
	 * Purpose: Prompts the user for the inner diameter of a grain,
	 * 		then returns the answer.
	 * 
	 * Parameters:
	 * 		Scanner input -- User input, preferably keyboard input.
	 * 
	 * Returns: double. The inner diameter of a grain.
	**/
	
	private static double promptInnerDiameter (Scanner input)
	{
		// Check for null scanner
		if (input == null)
			throw new IllegalArgumentException(NULL_SCANNER_MSG);
		
		// Prompt the user for input until a non-negative number or error
		double innerDiameter = -1.0;
		while (innerDiameter <= 0.0)
		{
			System.out.print(INNER_DIAMETER_PROMPT);   // Prompt message
			
			// Response was not a double, error
			if (input.hasNextDouble() == false)
			{
				System.err.println(INPUT_ERROR_MSG);
				System.exit(ERROR_OCCURRED);
			}
			
			// Valid input
			else
				innerDiameter = input.nextDouble();
			
		}
		
		return innerDiameter;
	} // promptInnerDiameter()
	
	
	
	/**
	 * promptLength()
	 * 
	 * Purpose: Prompts the user for the length of a grain,
	 * 		then returns the answer.
	 * 
	 * Parameters:
	 * 		Scanner input -- User input, preferably keyboard input.
	 * 
	 * Returns: double. The length of the grain.
	**/
	
	private static double promptLength (Scanner input)
	{
		// Check for null scanner
		if (input == null)
			throw new IllegalArgumentException(NULL_SCANNER_MSG);
		
		// Prompt the user for input until a non-negative number or error
		double length = -1.0;
		while (length <= 0.0)
		{
			System.out.print(LENGTH_PROMPT);   // Prompt message
			
			// Response was not a double, error
			if (input.hasNextDouble() == false)
			{
				System.err.println(INPUT_ERROR_MSG);
				System.exit(ERROR_OCCURRED);
			}
			
			// Valid input
			else
				length = input.nextDouble();
			
		}
		
		return length;
	} // promptLength()
	
	
	
	/**
	 * promptNumBurningEnds()
	 * 
	 * Purpose: Prompts the user for the number of burning ends,
	 * 		then returns the answer.
	 * 
	 * Parameters:
	 * 		Scanner input -- User input, preferably keyboard input.
	 * 
	 * Returns: int. The number of burning ends.
	**/
	
	private static int promptNumBurningEnds (Scanner input)
	{
		// Check for null scanner
		if (input == null)
			throw new IllegalArgumentException(NULL_SCANNER_MSG);
		
		// Prompt the user for input until 0, 1, 2, or error
		int numBurningEnds = -1;
		while (numBurningEnds < 0 || numBurningEnds > 2)
		{
			System.out.print(BURNING_ENDS_PROMPT);   // Prompt message
			
			// Response was not a double, error
			if (input.hasNextInt() == false)
			{
				System.err.println(INPUT_ERROR_MSG);
				System.exit(ERROR_OCCURRED);
			}
			
			// Valid input
			else
				numBurningEnds = input.nextInt();
		}
		
		return numBurningEnds;
	} // promptNumBurningEnds()
	
	
	
	
	
	
	
	
	/**
	 * 
	**/
	
	private static Nozzle createNozzle (Scanner input, int numberOfGrains)
	{
		
		double throatDiameter = -1;
		double entranceDiameter = -1;
		double exitDiameter = -1;
		double cf = -1;
		
		while(throatDiameter <= 0)
		{
			System.out.print("What is the Nozzle's throat Diameter? must be positive.  ");
			if(input.hasNextInt() == false)
			{
				System.err.println("\nERROR: Something went wrong with scanner.");
			}
			else
			{
				throatDiameter = input.nextInt();
			}
		}
		
		while(entranceDiameter <= 0)
		{
			System.out.print("What is the Nozzle's entrance Diameter? must be positive.  ");
			if(input.hasNextInt() == false)
			{
				System.err.println("\nERROR: Something went wrong with scanner.");
			}
			else
			{
				entranceDiameter = input.nextInt();
			}
		}
		while(exitDiameter <= 0)
		{
			System.out.print("What is the Nozzle's exit Diameter? must be positive.  ");
			if(input.hasNextInt() == false)
			{
				System.err.println("\nERROR: Something went wrong with scanner.");
			}
			else
			{
				exitDiameter = input.nextInt();
			}
		}
		while(cf <= 0)
		{
			System.out.print("What is the Nozzle's cf? must be positive.  ");
			if(input.hasNextInt() == false)
			{
				System.err.println("\nERROR: Something went wrong with scanner.");
			}
			else
			{
				cf = input.nextInt();
			}
		}
		
		return (new Nozzle(throatDiameter, entranceDiameter, exitDiameter, cf, numberOfGrains));
	}
	
	
	
	
} // class Main
